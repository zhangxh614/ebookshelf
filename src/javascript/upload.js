'use strict';
var data = {
	"name": "幽灵",
	"images": [{
		"img": "https://img3.doubanio.com/lpic/s29450044.jpg"
	}],
	"info": " 作者:   [挪威] 尤·奈斯博  出版社:湖南文艺出版社 原作名:Gjenferd  译者:   林立仁  出版年:2017-6-10 页数:464 定价:42.00元 装帧:平装 丛书: “哈利·霍勒警探”系列 ISBN:9787540480790 ",
	"rating_num": "评分 8.7",
	"intro": " ** 也许生命只教过你一件事，那就是时光无法倒流。 两个孤独少年 × 一位孤勇警探 如父如子的亲情，失而复得的挚爱，触不可及的未来 ** 作品全球销量突破3300万册 北欧悬疑小说天王尤•奈斯博《猎豹》之后再创销售奇迹 ** 入围英国犯罪小说作家协会国际匕首奖决选，荣登《纽约时报》《出版人周刊》《洛杉矶时报》畅销榜 哈利自我放逐到香港之后，以为从此远离警探生涯给他造成的创伤。但令人难以置信的事情发生了——曾与哈利情同父子的少年欧雷克，因涉嫌杀人而被警方逮捕。哈利无法相信欧雷克是杀人凶手，因此返回奥斯陆试图找出真凶，挑战一桩在警方看来已经罪证确凿的毒虫命案。 为了拯救他誓言守护的少年，在律师汉斯和昔日旧友贝雅特的帮助下，哈利只身展开调查。然而他发现自己面对的是一个让人彻底迷失的处境。如幽灵般神秘飘忽的贩毒组织幕后首脑，渴望权力的政客，收受黑钱的警方……... (展开全部) ** 也许生命只教过你一件事，那就是时光无法倒流。 两个孤独少年 × 一位孤勇警探 如父如子的亲情，失而复得的挚爱，触不可及的未来 ** 作品全球销量突破3300万册 北欧悬疑小说天王尤•奈斯博《猎豹》之后再创销售奇迹 ** 入围英国犯罪小说作家协会国际匕首奖决选，荣登《纽约时报》《出版人周刊》《洛杉矶时报》畅销榜 哈利自我放逐到香港之后，以为从此远离警探生涯给他造成的创伤。但令人难以置信的事情发生了——曾与哈利情同父子的少年欧雷克，因涉嫌杀人而被警方逮捕。哈利无法相信欧雷克是杀人凶手，因此返回奥斯陆试图找出真凶，挑战一桩在警方看来已经罪证确凿的毒虫命案。 为了拯救他誓言守护的少年，在律师汉斯和昔日旧友贝雅特的帮助下，哈利只身展开调查。然而他发现自己面对的是一个让人彻底迷失的处境。如幽灵般神秘飘忽的贩毒组织幕后首脑，渴望权力的政客，收受黑钱的警方……没人希望哈利回来，找出真相…… 尤•奈斯博，风靡全球的挪威作家，北欧犯罪小说天王，每一部作品几乎都是挪威图书畅销排行榜冠军。他拿过北欧的所有犯罪小说大奖，包括玻璃钥匙奖、挪威史上最佳犯罪小说奖、书店业者大奖等，还获得英国国际匕首奖和美国爱伦•坡奖提名，作品被翻译成40种语言，在50多个国家出版，全球销量突破3300万册。 奈斯博曾是挪威知名的摇滚巨星，白天任职于金融业，利用晚上和周末时间演出。不久，他考得金融分析师执照，被挪威最大的证券公司高薪挖走。然而工作和乐团越来越难以兼顾，濒临崩溃的奈斯博决定休半年长假。他带着笔记本电脑，跳上飞机，前往澳大利亚，在那里写下了日后让自己声名大噪的“哈利•霍勒警探”系列的第一部。 奈斯博受到英美犯罪小说名家一致推崇，迈克尔•康奈利称赞他是“我最喜欢的惊悚作家”。评论家普遍认为，奈斯博可与丹尼斯•勒翰、詹姆斯•艾尔罗伊、迈克尔•康奈利、伊恩•兰金、... (展开全部) 尤•奈斯博，风靡全球的挪威作家，北欧犯罪小说天王，每一部作品几乎都是挪威图书畅销排行榜冠军。他拿过北欧的所有犯罪小说大奖，包括玻璃钥匙奖、挪威史上最佳犯罪小说奖、书店业者大奖等，还获得英国国际匕首奖和美国爱伦•坡奖提名，作品被翻译成40种语言，在50多个国家出版，全球销量突破3300万册。 奈斯博曾是挪威知名的摇滚巨星，白天任职于金融业，利用晚上和周末时间演出。不久，他考得金融分析师执照，被挪威最大的证券公司高薪挖走。然而工作和乐团越来越难以兼顾，濒临崩溃的奈斯博决定休半年长假。他带着笔记本电脑，跳上飞机，前往澳大利亚，在那里写下了日后让自己声名大噪的“哈利•霍勒警探”系列的第一部。 奈斯博受到英美犯罪小说名家一致推崇，迈克尔•康奈利称赞他是“我最喜欢的惊悚作家”。评论家普遍认为，奈斯博可与丹尼斯•勒翰、詹姆斯•艾尔罗伊、迈克尔•康奈利、伊恩•兰金、雷蒙德•钱德勒等名家相提并论，称他是“挪威犯罪书写的毕加索”；德国《明镜》周刊则赞他为“斯堪的纳维亚的奇迹”。他的读者族群广泛，涵盖纯文学、冷硬推理、黑色小说，以及通俗惊悚小说爱好者。 ",
	"recommend": [{
			"link": "https://book.douban.com/subject/27077201/",
			"img": "https://img1.doubanio.com/spic/s29494439.jpg",
			"name": "警察"
		},
		{
			"link": "https://book.douban.com/subject/27041352/",
			"img": "https://img1.doubanio.com/spic/s29447269.jpg",
			"name": "四型生理时钟"
		},
		{
			"link": "https://book.douban.com/subject/26992417/",
			"img": "https://img3.doubanio.com/spic/s29389226.jpg",
			"name": "少年台湾"
		},
		{
			"link": "https://book.douban.com/subject/27073403/",
			"img": "https://img1.doubanio.com/spic/s29489918.jpg",
			"name": "等你呼唤我的名字"
		},
		{
			"link": "https://book.douban.com/subject/27044089/",
			"img": "https://img3.doubanio.com/spic/s29453661.jpg",
			"name": "最后的精灵"
		},
		{
			"link": "https://book.douban.com/subject/27041940/",
			"img": "https://img3.doubanio.com/spic/s29447952.jpg",
			"name": "《冰火大明》"
		},
		{
			"link": "https://book.douban.com/subject/27041945/",
			"img": "https://img1.doubanio.com/spic/s29447959.jpg",
			"name": "《黑白大清》"
		},
		{
			"link": "https://book.douban.com/subject/27044085/",
			"img": "https://img3.doubanio.com/spic/s29458343.jpg",
			"name": "匠人精神II——追求极致的日式工作..."
		},
		{
			"link": "https://book.douban.com/subject/26911951/",
			"img": "https://img3.doubanio.com/spic/s29424104.jpg",
			"name": "霹雳钻"
		},
		{
			"link": "https://book.douban.com/subject/26956486/",
			"img": "https://img3.doubanio.com/spic/s29451465.jpg",
			"name": "无根之木"
		}
	]
};

$(function() {
	var handler = {
		init: function() {
			handler.addEventListeners();
		},

		addEventListeners: function() {
			var self = this;

			document.querySelector(".controls input[type=file]").addEventListener("change", function(e) {
				if (e.target.files && e.target.files.length) {
					handler.decode(URL.createObjectURL(e.target.files[0]));
				}
			});

			document.querySelector("#rerun").addEventListener("click", function(e) {
				var input = document.querySelector(".controls input[type=file]");
				if (input.files && input.files.length) {
					handler.decode(URL.createObjectURL(input.files[0]));
				}
			});

		},

		decode: function(_src) {
			var self = this;
			let config = $.extend({}, self.state, {
				src: _src
			});
			Quagga.decodeSingle(config, function(result) {
				if (result === undefined) {
					alert("Not code in the picture.");
				} else if (result.codeResult) {
					let json = '{\"ISBN\":\"' + result.codeResult.code + '\"}';
					self.handleData(data);
				} else {
					alert("Not detected");
				}
			});
		},
		state: {
			inputStream: {
				size: 800,
				singleChannel: false
			},
			locator: {
				patchSize: "medium",
				halfSample: true
			},
			decoder: {
				readers: [{
					format: "ean_reader",
					config: {}
				}]
			},
			locate: true,
			src: null
		},

		handleData: function(res) {
			// fetch("/crawl", {
			// method: "POST",
			// body: json
			// })
			// .then(function(res) {
			// alert(res);
			ReactDOM.render(
				//	<article class="post">
				<h4 className="post-title">hello,world!</h4>,
				/*      <img class="post-photo" src={res['image'][0]['img']}/> */
				// <p class="post-info">{res['info']}</p>
				// <p class="post-number">{res['rating_num']}</p>
				// <div class="post-list">{
				// res['recommend'].map(function(item) {
				// return <a src={item['link']}>{item['name']}</a>
				// })
				// }
				// </div>
				// </article>, 
			 document.getElementById('result');
			);
			//	});
		}


	};

	handler.init();

	function calculateRectFromArea(canvas, area) {
		var canvasWidth = canvas.width,
			canvasHeight = canvas.height,
			top = parseInt(area.top) / 100,
			right = parseInt(area.right) / 100,
			bottom = parseInt(area.bottom) / 100,
			left = parseInt(area.left) / 100;

		top *= canvasHeight;
		right = canvasWidth - canvasWidth * right;
		bottom = canvasHeight - canvasHeight * bottom;
		left *= canvasWidth;

		return {
			x: left,
			y: top,
			width: right - left,
			height: bottom - top
		};
	}

	Quagga.onProcessed(function(result) {
		var drawingCtx = Quagga.canvas.ctx.overlay,
			drawingCanvas = Quagga.canvas.dom.overlay,
			area;

		if (result) {
			if (result.boxes) {
				drawingCtx.clearRect(0, 0, parseInt(drawingCanvas.getAttribute("width")), parseInt(drawingCanvas.getAttribute("height")));
				result.boxes.filter(function(box) {
					return box !== result.box;
				}).forEach(function(box) {
					Quagga.ImageDebug.drawPath(box, {
						x: 0,
						y: 1
					}, drawingCtx, {
						color: "green",
						lineWidth: 2
					});
				});
			}

			if (result.box) {
				Quagga.ImageDebug.drawPath(result.box, {
					x: 0,
					y: 1
				}, drawingCtx, {
					color: "#00F",
					lineWidth: 2
				});
			}

			if (result.codeResult && result.codeResult.code) {
				Quagga.ImageDebug.drawPath(result.line, {
					x: 'x',
					y: 'y'
				}, drawingCtx, {
					color: 'red',
					lineWidth: 3
				});
			}

			if (handler.state.inputStream.area) {
				area = calculateRectFromArea(drawingCanvas, handler.state.inputStream.area);
				drawingCtx.strokeStyle = "#0F0";
				drawingCtx.strokeRect(area.x, area.y, area.width, area.height);
			}
		}
	});

});
